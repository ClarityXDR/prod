rule: DetectKnownMalwareHashes
meta:
  title: "Detect files with known malware hashes"
  author: "Auto-Converted"
  date: "2025-06-08"
  mitre_techniques: []
  severity: "medium"
  description: "Detects files with known bad SHA256 hashes. Edit the list of hashes to match your threat intel."
  references: []

tables:
  primary: "DeviceFileEvents"

detection:
  selection:
    SHA256|contains:
      - "known_hash_1"
      - "known_hash_2"
      - "known_hash_3"
  filter: {}

timeframe: "1d"
frequency: "1h"
condition: "selection"

response:
  actions:
    - type: "collect_investigation_package"
      target: "DeviceId"

kql:
  query: |
    let KnownBadHashes = pack_array(
        "known_hash_1",  // Replace with actual known bad hashes
        "known_hash_2",
        "known_hash_3"
    );
    DeviceFileEvents
    | where SHA256 in (KnownBadHashes)
    | project Timestamp, DeviceId, DeviceName, SHA256, FileName, FolderPath
  syntax: KQL

output:
  required_columns: ["DeviceName", "SHA256", "FileName", "FolderPath", "Timestamp"]
  entity_columns: []
