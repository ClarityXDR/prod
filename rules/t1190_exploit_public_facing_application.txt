rule: ExploitPublicFacingApplication
meta:
  title: "Exploit Public-Facing Application (T1190)"
  author: "Auto-Generated"
  date: "2025-06-08"
  mitre_techniques: ["T1190"]
  severity: "high"
  description: "Detects suspicious commands executed by public-facing applications."
tables:
  primary: "DeviceProcessEvents"
detection:
  selection:
    InitiatingProcessFileName|in:
      - "w3wp.exe"
      - "httpd.exe"
      - "nginx.exe"
      - "tomcat.exe"
      - "php-cgi.exe"
      - "node.exe"
      - "java.exe"
    ProcessCommandLine|has_any:
      - "cmd.exe"
      - "powershell.exe"
      - "powershell -enc"
      - "python"
      - "perl"
      - "nc "
      - "netcat"
      - "curl "
      - "wget "
      - "certutil"
      - "mshta.exe"
      - "ftp "
      - "tftp "
      - "whoami"
      - "net user"
      - "nslookup"
      - "Invoke-WebRequest"
      - "Invoke-Expression"
  filter: {}
timeframe: "7d"
frequency: "1h"
condition: "selection"
response:
  actions:
    - type: "collect_investigation_package"
      target: "DeviceId"
kql:
  query: |
    DeviceProcessEvents
    | where InitiatingProcessFileName in ("w3wp.exe", "httpd.exe", "nginx.exe", "tomcat.exe", "php-cgi.exe", "node.exe", "java.exe")
    | where ProcessCommandLine has_any ("cmd.exe", "powershell.exe", "powershell -enc", "python", "perl", "nc ", "netcat", "curl ", "wget ", "certutil", "mshta.exe", "ftp ", "tftp ", "whoami", "net user", "nslookup", "Invoke-WebRequest", "Invoke-Expression")
    | project TimeGenerated, DeviceId, DeviceName, FileName, ProcessCommandLine, InitiatingProcessFileName, InitiatingProcessCommandLine, AccountName
  syntax: KQL

output:
  required_columns: ["Timestamp", "DeviceName", "FileName", "ProcessCommandLine", "InitiatingProcessFileName", "InitiatingProcessCommandLine"]
  entity_columns: []
